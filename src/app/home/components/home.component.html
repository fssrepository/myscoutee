<div class="game-page">
  <header class="game-header">
    <div>
      <h1>Myscoutee</h1>
    </div>
    <div class="game-actions">
      <button type="button" class="game-action-mode" [class.mode-pair]="isPairMode" [class.mode-single]="!isPairMode" (click)="togglePairMode()">
        <mat-icon>{{ isPairMode ? 'groups' : 'person' }}</mat-icon>
        <span>{{ isPairMode ? 'Pair mode' : 'Single mode' }}</span>
      </button>
      <button type="button" class="game-action-filter has-badge" (click)="openFilter()" aria-label="Open profile filters">
        <mat-icon>filter_alt</mat-icon>
      </button>
      <button type="button" class="game-action-filter has-badge" (click)="openFilter()" aria-label="Open profile filters">
        <mat-icon>history</mat-icon>
        <span class="history-badge">{{ activeUser.activities.game }}</span>
      </button>
    </div>
  </header>

  <section class="game-layout-single">
    <article class="card-stack game-card-main">
      <div class="card-content">
        <h2>{{ activeCandidate.name }}, {{ activeCandidate.age }}</h2>
        <p>{{ activeCandidate.city }} · {{ activeCandidate.statusText }}</p>
        <p>{{ activeCandidate.headline }}</p>
      </div>
      <div class="game-image-stack-indicators" *ngIf="candidateImageStack.length > 1">
        <button
          type="button"
          class="game-image-stack-line"
          *ngFor="let image of candidateImageStack; let i = index"
          [class.active]="i === selectedCandidateImageIndex"
          (click)="selectCandidateImage(i)"
          aria-label="Select profile image"
        ></button>
      </div>
      <div class="card-image-area">
        <div
          class="card-image-content"
          [style.backgroundImage]="candidateImage ? 'url(' + candidateImage + ')' : 'none'"
          [style.transform]="'translate(' + candidateImagePanX + 'px,' + candidateImagePanY + 'px) scale(' + candidateImageZoom + ')'"
          [class.is-draggable]="candidateImageZoom > 1"
          (wheel)="onCandidateImageWheel($event)"
          (mousedown)="onCandidateImageMouseDown($event)"
          (mousemove)="onCandidateImageMouseMove($event)"
          (mouseup)="onCandidateImageMouseUp()"
          (mouseleave)="onCandidateImageMouseUp()"
          (touchstart)="onCandidateImageTouchStart($event)"
          (touchmove)="onCandidateImageTouchMove($event)"
          (touchend)="onCandidateImageTouchEnd()"
          (touchcancel)="onCandidateImageTouchEnd()"
        >
          <div class="game-image-hit-area" *ngIf="candidateImageStack.length > 1">
            <button
              type="button"
              class="game-image-hit-segment"
              *ngFor="let image of candidateImageStack; let i = index"
              (click)="selectCandidateImage(i)"
              aria-label="Select profile image"
            ></button>
          </div>
          <span class="card-image-placeholder" *ngIf="!candidateImage">{{ candidateInitials }}</span>
        </div>
      </div>
      <div class="rating-stars">
        <button
          type="button"
          class="star-btn"
          *ngFor="let score of ratingScale"
          [class.filled]="score <= selectedRating"
          (click)="setRating(score)"
          aria-label="Rate {{ score }}"
        >
          ★
        </button>
      </div>
    </article>
  </section>
</div>

<section class="game-popup" *ngIf="localPopup === 'history'">
  <div class="game-popup-backdrop" (click)="closeLocalPopup()"></div>
  <div class="game-popup-panel" (click)="$event.stopPropagation()">
    <header>
      <h2>Profile Filter</h2>
      <button type="button" (click)="closeLocalPopup()">×</button>
    </header>
    <div class="game-popup-body">
      <p>Filters: profession, school, friends in common.</p>
      <p>Mode: single/pair, distance and recent activity.</p>
    </div>
  </div>
</section>
