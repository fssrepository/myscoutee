[
        {
            "$match": {
                "_id": "?0"
            }
        },
        {
            "$unwind": "$members"
        },
        {
            "$lookup": {
                "from": "profiles",
                "let": { "p_id": "$members.profile.$id", "p_members" : "$members" },
                "pipeline": [
                    {
                        "$match": {
                            "$expr": {
                                "$eq": ["$$p_id", "$_id"]
                            }
                        }
                    },
                    {
                        "$project": {
                            "_id": "$$p_members._id",
                            "profile": "$$ROOT",
                            "createdDate": "$$p_members.createdDate",
                            "status": "$$p_members.status"
                        }
                    }
                ],
                "as": "profiles"
            }
        },
        {
            "$unwind": "$profiles"
        },
        {
            "$group": {
                "_id": "$profiles._id",
                "data": {
                    "$first": "$profiles"
                }
            }
        },
        {
            "$match": {
                "$expr": {
                    "$and": [
                        { "$gt": [{ "$ifNull": ["$data.createdDate", "ISODate()"] }, { "$toDate": ":#{#offset[1]}" }] },
                        { "$in": ["$data.status", ":#{#status}"] },
                        { "$gte": ["$data.status", ":#{#offset[0]}"] }
                    ]
                }
            }
        },
        {
            "$sort": {
                "data.status": 1,
                "data.createdDate": -1
            }
        },
        {
            "$limit": "?1"
        },
        {
            "$replaceRoot": {
                "newRoot": {
                    "$mergeObjects": [
                        { "member": "$data" },
                        { "offset": ["$data.status", "$data.createdDate"] }
                    ]
                }
            }
        }
    ]
    