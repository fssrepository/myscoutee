[
        {
            "$match": {
                "info.members": {
                    "$elemMatch": {
                        "profile.$id": "?0",
                        "status": ":#{#status}"
                    }
                }
            }
        },
    
        {
            "$match": {
                "$expr": {
                    "$and": [
                        { "$gt": ["$info.range.start", { "$toDate": ":#{#offset[0]}" }] },
                        { "$gt": ["$createdDate", { "$toDate": ":#{#offset[1]}" }] }
                    ]
                }
            }
        },
    
        {
            "$lookup": {
                "from": "profiles",
                "let": { "p_id": "$info.members.profile.$id" },
                "pipeline": [
                    {
                        "$match": {
                            "$expr": {
                                "$in": ["$_id", "$$p_id"]
                            }
                        }
                    }
                ],
                "as": "profiles"
            }
        },
    
        {
            "$unwind": { "path": "$profiles" }
        },
    
        {
            "$group": {
                "_id": "$profiles._id",
                "createdDate": {
                    "$min": "$createdDate"
                },
                "startDate": {
                    "$max": "$info.range.start"
                },
                "data": { "$first": "$profiles" }
            }
        },
    
        {
            "$match": {
                "$expr": {
                    "$and": [
                        { "$ne": ["$_id", "?0"] },
                        { "$gt": ["$data.createdDate", { "$toDate": ":#{#offset[2]}" }] }
                    ]
                }
            }
        },
    
        {
            "$sort": {
                "startDate": 1,
                "createdDate": 1,
                "data.createdDate": -1
            }
        },
    
        {
            "$limit": "?1"
        },
    
        {
            "$addFields": {
                "groupKey": {
                    "$dateToString": {
                        "format": "%Y-%m-%d",
                        "date": "$startDate"
                    }
                }
            }
        },
    
        {
            "$replaceRoot": {
                "newRoot": {
                    "$mergeObjects": [
                        { "profile": "$data" },
                        { "groupKey": "$groupKey", "offset": ["$startDate", "$createdDate", "$data.createdDate"] }
                    ]
                }
            }
        }
    ]
    