[
        {
            "$match": {
                "_id": "?0"
            }
        },
        {
            "$lookup": {
                "from": "schools",
                "localField": "schools.$id",
                "foreignField": "_id",
                "as": "schools"
            }
        },
        {
            "$unwind": "$schools"
        },
        {
            "$group": {
                "_id": "$schools._id",
                "data": { "$first": "$schools" }
            }
        },
        {
            "$match": {
                "$expr": {
                    "$and": [
                        { "$eq": [ "$data.status", "A" ] },
                        { "$gte": [ "$data.type", ":#{#offset[0]}" ] },
                        { "$gt": [ "$data.range.start", { "$toDate": ":#{#offset[1]}" } ] },
                        { "$gt": [ { "$ifNull": [ "$data.createdDate", "ISODate()" ] }, { "$toDate": ":#{#offset[2]}" } ] }
                    ]
                }
            }
        },
        {
            "$sort": {
                "data.type": 1,
                "data.range.start": 1,
                "data.createdDate": 1
            }
        },
        { "$limit": "?1" },
        {
            "$replaceRoot": {
                "newRoot": {
                    "$mergeObjects": [
                        { "school": "$data" },
                        { "groupKey": "$data.type", "offset": ["$data.type", "$data.range.start", "$data.createdDate"] }
                    ]
                }
            }
        }
    ]
    