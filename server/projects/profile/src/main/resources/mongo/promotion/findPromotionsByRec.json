[
        {
            "$geoNear": {
                "near": "?1",
                "spherical": true,
                "minDistance": ":#{#offset[0]}",
                "distanceField": "distance",
                "distanceMultiplier": 0.001,
                "query": { "group.$id": "?5" }
            }
        },
        {
            "$match": {
                "$expr": {
                    "$and": [
                        { "$gt": [ "$cnt", 0 ] }
                    ]
                }
            }
        },
        {
            "$addFields": {
                "groupKey": { "$multiply": [ { "$floor": [ { "$divide": [ "$distance", "?3" ] } ] }, "?3" ] }
            }
        },
        {
            "$sort": {
                "groupKey": 1,
                "distance": 1,
                "createdDate": -1
            }
        },
        {
            "$limit": "?2"
        },
        {
            "$replaceRoot": {
                "newRoot": {
                    "$mergeObjects": [ { "promotion": "$$ROOT" }, { "groupKey": "$groupKey", "offset": [ "$groupKey", "$distance", "$createdDate" ] } ]
                }
            }
        }
    ]
    