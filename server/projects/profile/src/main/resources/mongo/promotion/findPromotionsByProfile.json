[
        {
            "$match": {
                "createdBy": "?0"
            }
        },
        {
            "$match": {
                "$expr": {
                    "$and": [
                        { "$gt": [ "$range.start", { "$toDate": ":#{#offset[0]}" } ] },
                        { "$gt": [ { "$ifNull": [ "$createdDate", "ISODate()" ] }, { "$toDate": ":#{#offset[1]}" } ] }
                    ]
                }
            }
        },
        {
            "$sort": {
                "range.start": 1,
                "type": 1,
                "createdDate": 1
            }
        },
        {
            "$limit": "?1"
        },
        {
            "$replaceRoot": {
                "newRoot": {
                    "$mergeObjects": [ { "promotion": "$$ROOT" }, { "groupKey": "$createdDate", "offset": [ "$range.start", "$type", "$createdDate" ] } ]
                }
            }
        }
    ]
    